# –ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞—à–µ–≥–æ workflow, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –Ω–∞ GitHub
name: Run Python Tests

# –¢—Ä–∏–≥–≥–µ—Ä: –∑–∞–ø—É—Å–∫–∞—Ç—å —ç—Ç–æ—Ç workflow –ø—Ä–∏ –∫–∞–∂–¥–æ–º 'push' –≤ –≤–µ—Ç–∫—É 'main'
on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

# –ó–∞–¥–∞–Ω–∏—è (jobs), –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å
jobs:
  build:
    # –£–∫–∞–∑—ã–≤–∞–µ–º –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –¥–ª—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã
    runs-on: ubuntu-latest

    # –®–∞–≥–∏ (steps), –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
    steps:
      # –®–∞–≥ 1: –ö–ª–æ–Ω–∏—Ä—É–µ–º –∫–æ–¥ –∏–∑ –Ω–∞—à–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –Ω–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É
      - name: Checkout repository
        uses: actions/checkout@v3

      # –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ Python
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11" # –£–∫–∞–∑—ã–≤–∞–µ–º –≤–µ—Ä—Å–∏—é Python

      # –®–∞–≥ 3: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–∑ –Ω–∞—à–µ–≥–æ —Ñ–∞–π–ª–∞
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # –®–∞–≥ 4: –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–∞—à–∏ —Ç–µ—Å—Ç—ã —Å –ø–æ–º–æ—â—å—é pytest
      - name: Run tests with pytest
        # üëá –ù–û–í–´–ô –ë–õ–û–ö 'env'
        env:
          LOGIN: ${{ secrets.LOGIN }}
          PASSWORD: ${{ secrets.PASSWORD }}
        run: |
          pytest --html=report.html

      # --- –ó–ê–ì–†–£–ó–ö–ê –ê–†–¢–ï–§–ê–ö–¢–ê ---
      - name: Upload report artifact
        # 'if: always()' –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ —à–∞–≥ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è, –¥–∞–∂–µ –µ—Å–ª–∏ —Ç–µ—Å—Ç—ã —É–ø–∞–ª–∏
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: test-report # –ù–∞–∑–≤–∞–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞
          path: report.html # –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å
